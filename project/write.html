<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>글쓰기</title>
  <link rel="stylesheet" href="mainstyle.css">
  <style>
    .content-wrapper {
  display: flex;
  margin-top: 20px;
  flex-direction: column;  /* 세로 배열 */
  align-items: flex-start; /* 왼쪽 정렬 */
  margin: 50px;
  margin-left: 100px;
  flex-grow: 1;
  width: auto;
  max-width: 900px;
}

h2 {
  color: #007BFF;
  margin: 0 0 20px 0;  /* 아래쪽 여백만 */
}

form {
  width: 100%;
  margin: 0;
  padding: 20px;
  box-sizing: border-box;
}
    /* 1. form의 부모 요소가 너비 제한이 없도록 */
.container {
  max-width: 100%;
  width: 100%;
}

/* 3. input, textarea 확장 유지 */
input, textarea {
  width: 100%;
  padding: 15px;
  font-size: 16px;
  box-sizing: border-box;
}

  @media (max-width: 500px) {
  .author-options {
    flex-direction: column;
    align-items: flex-start;
  }
}

    label {
      display: block;
      margin-top: 15px;
    }

    .label-text {
      color: skyblue;
    }
    button {
  margin-top: 20px;
  padding: 12px 30px;
  font-size: 16px;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #218838;
}

    button:hover {
      background-color: #218838;
    }

    .author-options {
  display: flex;
  flex-wrap: wrap; /* 줄바꿈 허용 */
  gap: 20px;
  margin-top: 5px;
}

.author-options label {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  min-width: 80px;
  white-space: nowrap;
}

input, textarea {
  width: 100%;
  padding: 15px;
  font-size: 16px;
  box-sizing: border-box;
  background-color: #000;   /* 배경색: 검정 */
  color: #fff;              /* 글자색: 흰색 */
  border: 1px solid #444;   /* 테두리 색도 어둡게 */
}

#content {
  height: 300px;
  resize: vertical;
}
  .fixed-profile {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background-color: #1a1a1a;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 100;
}

.fixed-profile-img {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 4px;
  border: 1px solid #888;
}

.fixed-profile-btn {
  color: black;
  background-color: #00cc66;
  padding: 6px 10px;
  border-radius: 0;
  text-decoration: none;
  font-weight: bold;
  font-size: 14px;
  transition: background-color 0.3s ease;
}

.fixed-profile-btn:hover {
  background-color: #00aa55;
}

/* 모바일 반응형 추가 스타일 */
@media (max-width: 768px) {
  .content-wrapper {
    margin: 20px 15px;
    margin-left: 15px;
    max-width: none;
  }

  form {
    padding: 15px;
  }

  input, textarea {
    padding: 12px;
    font-size: 14px;
  }

  #content {
    height: 250px;
  }

  button {
    padding: 10px 25px;
    font-size: 14px;
    width: 100%;
  }

  .fixed-profile {
    bottom: 20px;
    right: 20px;
    left: auto;
  }

  .fixed-profile-img {
    width: 35px;
    height: 35px;
  }

  .fixed-profile-btn {
    font-size: 12px;
    padding: 5px 8px;
  }
}

@media (max-width: 480px) {
  .content-wrapper {
    margin: 15px 10px;
  }

  form {
    padding: 10px;
  }

  input, textarea {
    padding: 10px;
    font-size: 14px;
  }

  #content {
    height: 200px;
  }

  .author-options {
    gap: 15px;
  }

  h2 {
    font-size: 20px;
  }
}
  </style>
</head>
<body>
  <header>
    <a href="main.html" style="color: inherit; text-decoration: none;">코딩숙터디</a>
  </header>
  <div class="container">
  <!-- 데스크톱 네비게이션 -->
  <nav class="desktop-nav">
    <ul>
      <li>
        <div class="menu-title">코딩</div>
        <ul class="submenu">
          <li><a href="coding1.html">파이썬, c, java</a></li>
          <li><a href="coding2.html">html, css, js</a></li>
        </ul>
      </li>
      <li>
        <div class="menu-title">프로젝트</div>
        <ul class="submenu">
          <li><a href="project1.html">팀원 모집</a></li>
          <li><a href="project2.html">프로젝트 후기</a></li>
        </ul>
      </li>
      <li>
        <div class="menu-title">강의</div>
        <ul class="submenu">
          <li><a href="lecture1.html">수강/시험 후기</a></li>
          <li><a href="lecture2.html">자유 게시판</a></li>
        </ul>
      </li>
      <li>
        <div class="menu-title">자격증</div>
        <ul class="submenu">
          <li><a href="license1.html">스터디 모집</a></li>
          <li><a href="license2.html">정보 공유방</a></li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- 햄버거 메뉴 버튼 -->
  <div class="hamburger" id="hamburger">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- 모바일 네비게이션 -->
  <nav class="mobile-nav" id="mobileNav">
    <ul>
      <li>
        <div class="menu-title">코딩</div>
        <ul class="submenu">
          <li><a href="coding1.html">파이썬, c, java</a></li>
          <li><a href="coding2.html">html, css, js</a></li>
        </ul>
      </li>
      <li>
        <div class="menu-title">프로젝트</div>
        <ul class="submenu">
          <li><a href="project1.html">팀원 모집</a></li>
          <li><a href="project2.html">프로젝트 후기</a></li>
        </ul>
      </li>
      <li>
        <div class="menu-title">강의</div>
        <ul class="submenu">
          <li><a href="lecture1.html">수강/시험 후기</a></li>
          <li><a href="lecture2.html">자유 게시판</a></li>
        </ul>
      </li>
      <li>
        <div class="menu-title">자격증</div>
        <ul class="submenu">
          <li><a href="license1.html">스터디 모집</a></li>
          <li><a href="license2.html">정보 공유방</a></li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- 오버레이 -->
  <div class="overlay" id="overlay"></div>

  <div class="content-wrapper">
  <h2 style="color: white;">게시글 작성</h2>
  <form id="writeForm">
    <label for="title">
      &lt;<span class="label-text">제목</span>&gt;
    </label>
    <input type="text" id="title" required>

  <label>
    &lt;<span class="label-text">작성자</span>&gt;
  </label>
  <div class="author-options">
    <label><input type="radio" name="author" value="익명" checked> 익명</label>
    <label>
      <input type="radio" name="author" value="" id="realNameOption">
      <span id="realNameLabel">내이름</span>
    </label>
  </div>

  <label for="content">
    &lt;<span class="label-text">내용</span>&gt;
  </label>
  <textarea id="content" rows="8" required></textarea>
  <button type="submit">등록</button>
  </form>
</div>

<script>
// 1. 로그인한 사용자 이름 가져오기 (쿠키에서)
function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}
const username = getCookie("loginUser") || "내이름";

// 2. 작성자 라디오 버튼의 이름 설정
const realNameRadio = document.getElementById("realNameOption");
const realNameLabel = document.getElementById("realNameLabel");
realNameRadio.value = username;
realNameLabel.textContent = username;

// 데스크톱 메뉴 기능
  const desktopTitles = document.querySelectorAll('.desktop-nav .menu-title');
  desktopTitles.forEach(title => {
    title.addEventListener('click', () => {
      const currentLi = title.closest('li');
      const isActive = currentLi.classList.contains('active');

      // 모두 닫기
      document.querySelectorAll('.desktop-nav ul li').forEach(li => li.classList.remove('active'));

      // 현재 항목만 열기
      if (!isActive) {
        currentLi.classList.add('active');
      }
    });
  });

  // 햄버거 메뉴 기능
  const hamburger = document.getElementById('hamburger');
  const mobileNav = document.getElementById('mobileNav');
  const overlay = document.getElementById('overlay');

  hamburger.addEventListener('click', toggleMobileMenu);
  overlay.addEventListener('click', closeMobileMenu);

  function toggleMobileMenu() {
    hamburger.classList.toggle('active');
    mobileNav.classList.toggle('active');
    overlay.classList.toggle('active');
    document.body.style.overflow = mobileNav.classList.contains('active') ? 'hidden' : '';
  }

  function closeMobileMenu() {
    hamburger.classList.remove('active');
    mobileNav.classList.remove('active');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
  }

  // 모바일 메뉴 아코디언 기능
  const mobileTitles = document.querySelectorAll('.mobile-nav .menu-title');
  mobileTitles.forEach(title => {
    title.addEventListener('click', () => {
      const currentLi = title.closest('li');
      const isActive = currentLi.classList.contains('active');

      // 모든 모바일 메뉴 닫기
      document.querySelectorAll('.mobile-nav ul li').forEach(li => li.classList.remove('active'));

      // 현재 항목만 열기
      if (!isActive) {
        currentLi.classList.add('active');
      }
    });
  });

  // 모바일 메뉴 링크 클릭 시 메뉴 닫기
  const mobileLinks = document.querySelectorAll('.mobile-nav .submenu a');
  mobileLinks.forEach(link => {
    link.addEventListener('click', closeMobileMenu);
  });

  // 창 크기 변경 시 모바일 메뉴 닫기
  window.addEventListener('resize', () => {
    if (window.innerWidth > 768) {
      closeMobileMenu();
    }
  });
// 4. 글 작성 중 감지
const urlParams = new URLSearchParams(window.location.search);
const board = urlParams.get("board") || "general";

let isFormDirty = false;
document.getElementById("title").addEventListener("input", () => isFormDirty = true);
document.getElementById("content").addEventListener("input", () => isFormDirty = true);

// 5. 페이지 이탈 시 경고
window.addEventListener("beforeunload", function (e) {
  if (isFormDirty) {
    e.preventDefault();
    e.returnValue = "";
  }
});

// 6. 메뉴 클릭 시 작성 중 경고
document.querySelectorAll('nav a').forEach(link => {
  link.addEventListener("click", function (e) {
    if (isFormDirty && !confirm("작성을 취소하시겠습니까?")) {
      e.preventDefault();
    }
  });
});

// 7. 글 등록 처리
  document.getElementById("writeForm").addEventListener("submit", function(event) {
    event.preventDefault();

    const title = document.getElementById("title").value.trim();
    const content = document.getElementById("content").value.trim();
    const author = document.querySelector('input[name="author"]:checked').value;
    const date = new Date().toISOString().split("T")[0];
    const id = Date.now();
    const board = new URLSearchParams(window.location.search).get("board") || "general";

    if (!title || !content) {
      alert("제목과 내용을 모두 입력해주세요.");
      return;
    }

    const post = { id, title, author, content, date, board };

    // 게시판 저장
    const posts = JSON.parse(localStorage.getItem(`posts_${board}`) || "[]");
    posts.unshift(post);
    localStorage.setItem(`posts_${board}`, JSON.stringify(posts));

    // 마이페이지용 별도 저장 (작성자 관계없이 로그인한 사용자 기준 저장)
    const loginUser = getCookie("loginUser");
    if (loginUser) {
      const myPostsKey = `user_posts_${loginUser}`;
      const myPosts = JSON.parse(localStorage.getItem(myPostsKey) || "[]");
      myPosts.unshift({ id, title, content, board }); // 작성자 정보는 제외
      localStorage.setItem(myPostsKey, JSON.stringify(myPosts));
    }

    alert("등록이 완료되었습니다!");
    isFormDirty = false; // 이 줄을 추가
    window.location.href = `post.html?id=${id}&board=${board}`;
  });
</script>
<!--좌측 하단 프로필&마이페이지-->
<div class="fixed-profile">
  <img id="profile-thumb" src="user.png" alt="프로필" class="fixed-profile-img">
  <a id="profile-btn" href="login.html" class="fixed-profile-btn">로그인</a>
</div>
  <script src="cookie.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const loginUser = GetCookie("loginUser");
    const nickname = localStorage.getItem("nickname");
    const profileImg = localStorage.getItem("profileImage");

    const profileThumb = document.getElementById("profile-thumb");
    const profileBtn = document.getElementById("profile-btn");

    if (loginUser) {
      // 로그인 상태일 때
      profileBtn.textContent = "마이페이지";
      profileBtn.href = "mypage.html";

      if (profileImg) {
        profileThumb.src = profileImg;
      }
    } else {
      // 비로그인 상태일 때
      profileBtn.textContent = "로그인";
      profileBtn.href = "login.html";
      profileThumb.src = "user.png";
    }
  });
</script>

</body>
</html>
